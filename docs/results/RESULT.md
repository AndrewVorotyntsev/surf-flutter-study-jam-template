# Целевая платформа

Andoid

# Результаты

## Архитектура

Для приложения был выбран архитектурый паттерн MWWM, основанный на пакете [surf_mwwm](https://pub.dev/packages/surf_mwwm)

## Авторизация
Экран авторизации состоит из двух полей для ввода текста и кнопки. К каждому текстовому полю привязан контроллер, благодаря которому появляется возможность получить и работать с данными в этих полях.
После нажатия на кнопку "Далее" происходит запрос на авторизацию, в который передаются данные из котроллеров текстовых полей. На время совершения запроса показан лоадер.  
* В случае успеха выдается токен, который сохраняется в памяти устройства (с помощью [shared_preferences](https://pub.dev/packages/shared_preferences)). Также сохраняется имя пользователя. После этого происходит переход на экран топиков.[1]
* В случае ошибки отображается снэкбар с информацией об ошибке в нижней части экрана.[2]  

В последующие входы в приложение, если пользователь не совершал логаут и намеренно не чистил данные, ему не придется каждый раз совершать авторизацию и он сразу попадет на экран топиков. Таким образом повышается удобство пользования.[3]

## Топики
Экран топиков состоит из аппбара, списка топиков и кнопки создания нового топика.
__Аппбару__ соответсвует собственная __виджет-модель__. Такой подход позволяет осуществить получения __имени пользователя__ из shared_preferences и отобразить его.  
Слева находится иконка с дверью, при нажатии на которую происходит __выход__ из аккаунта.[4] При этом происходит удаления токена и имени пользователя. Сюда передается колбэк с экрана, для того чтобы осущетсвить запрос для логаута.  
Справа находится иконка, нажатие на которую __обновляет__ список топиков.  
Список топиков предствален в виде карточек разделенных горизонтальными линиями. У топиков есть название в заголовке и у некоторых - описание ниже. Нажатие на каждую карточку сопровождается __ripple-эффектом__ [10].  
К низу экрана прикреплена FAB (floating action button), нажав на которую происходит переход к экрану добавления топика.  
## Создание топика
Экран создания топика состоит из двух полей для ввода текста: названия и описания, а также кнопки. По нажатию на кнопку происходит запрос для создания топика, данные для которого берутся из контролеров вышеперечисленных текстовых полей. После этого экран топиков обновляется и можно увидеть новый топик.[9]  
## Чат
По нажатию на карточку каждого топика происходит переход к экрану чата конкретного топика.[10] 
Он состоит из аппбара, списка сообщений и виджета отправки собственных сообщений.

В аппбаре содержится кнопка возврата к предыдущему экрану (к списку топиков) и кнопка обновления списка сообщений.
### Виджет сообщения
#### Бабл
Карточки сообщений представлены в виде баблов. Для этого используется сторонняя библиотека [bubble](https://pub.dev/packages/bubble)
Если сообщение отправлено пользователем , хвост у виджета направлен в право, для остальных - влево.
#### Аватарки
В каждом сообщении прикреплена аватарка пользователя. В ней отображаются первые буквы имени и фамилии. Аватарка каждого пользователя имеет __уникальный__ цвет. Это достигается за счет того, что в языке дарт у каждого объекта есть атрибут _hashcode_. Это целочисленное значение является уникальным для каждого объекта. Цвет во флаттере можно задать, передав в конструктор целое число. Таким образом, в виджете аватара в конструктор класса _Color_ передается хэшкод имени и для разных имен получается разный цвет.[12]  
```
color: Color(userData.name.hashCode),
```
#### Отправитель
Рядом с аватаркой, вверху карточки отображается имя пользователя, который отправил сообщение.
#### Контент сообщения
Сообщение может иметь контент различного рода:
* текст
* геолокация
* изображения

Текст отображается под именем пользователя. Он может быть многострочным.

Если к сообщению прикреплена __геолокация__, то в правой части будет находится иконка с картой, при нажатии на которую с помощью _url_ _launcher_ откроется ссылка в гугл картах с переданными координатами.[7]

Если пользователь добавил __изображения__, то они будут отображены внизу виджета сообщения. Если их 2 и больше, то чтобы увидеть их все нужно произвести свайп вправо. Точки внизу сообщения информируют о их количестве. Это сделано с использованием виджета _Swiper_ из сторонней библиотеки [card_swiper](https://pub.dev/packages/card_swiper).[11]

#### Анонимные сообщения
Если пользователь не указал свое имя, но в чате он будет отображен как "Аноним", вместо аватарки у него будет знак вопроса на белом фоне.[12]

### Отправка сообщения
Виджет отправки сообщения устроен следующим образом. Имеется поля для ввода текста сообщения. Также есть три иконки:
* иконка с меткой нужна для прикрепления геолокации

При нажатии на нее осуществится получения геолокации устройства с помощью библиотеки [geolocator](https://pub.dev/packages/geolocator). В это время пользователю будет показано диалоговое окно, уведомляющее о определении геолокации, а после от пользователя потребуется согласие на отправку геолокации.[6]

* иконка с изображением используется для добавления изображений

При нажатии на нее откроется диалоговое окно в котором необходимо ввести ссылку на изображение. Можно несколько раз вызвать окно и добавить несколько сообщений.[8]

* иконка со стрелкой - для отправки сообщения, при нажатии на которую происходит запрос на отправку сообщения, в который передается текст, ссылки на изображения и данные о геолокации.[5]

# Ссылки на демонстрацию работы/скриншоты

## 1. Успешная авторизация

https://user-images.githubusercontent.com/48821142/184497834-3292c8f4-837e-4b41-8745-ef894a337683.mp4

## 2. Снэкбар при ошибки авторизации

https://user-images.githubusercontent.com/48821142/184497839-7013e733-746f-40fc-8b99-77bfd32af41c.mp4

## 3. Сохранение аккаунта при закрытии приложения

https://user-images.githubusercontent.com/48821142/184497841-5db8c9e4-3199-431f-b210-34192e65d827.mp4

## 4. Логаут

https://user-images.githubusercontent.com/48821142/184497836-6dd02670-cc66-4ee9-9b3b-03adf4f61338.mp4

## 5. Отправка текстового сообщения

https://user-images.githubusercontent.com/48821142/184497842-4a9d67c4-fc2c-4c18-935c-22d0ac927ec0.mp4

## 6. Прикрепление геолокации

https://user-images.githubusercontent.com/48821142/184497835-9ae9f308-f0da-431d-9118-ebb8327602c5.mp4

## 7. Открытие карты

https://user-images.githubusercontent.com/48821142/184497838-58142f93-e8c8-463e-bd6d-30bb74ab7f24.mp4

## 8. Работа с изображениями

https://user-images.githubusercontent.com/48821142/184497833-3a638666-9d59-48a0-b633-438049e3a432.mp4

## 9. Создание топика

https://user-images.githubusercontent.com/48821142/184497840-c7d22b39-4fc8-45f2-9fd4-c3cfd9a13d63.mp4

## 10. Переход к топику (ripple-эффект)

https://user-images.githubusercontent.com/48821142/184498857-f760d0c8-6d4b-4942-aad6-506ff0c6f02d.mp4


## 11. Свайпер фото

https://user-images.githubusercontent.com/48821142/184498642-5be77805-daea-42b2-abf1-054f16addee1.mp4

## 12. Аватары

https://user-images.githubusercontent.com/48821142/184498992-ced599ae-1c68-4ff9-99bd-dc55766cb89f.mp4


